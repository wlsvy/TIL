# Refactoring

마틴 파울러 지음

![](RefactoringImage/2022-03-10-21-24-54.png)

## 서문

이 책은 전문 프로그래머를 대상으로 쓴 리팩터링 지침서다. 절제되고 효율적인 방식으로 리팩터링하는 법을 알려주는 것이 목표다. 코드에 버그가 생기지 않게 하면서 구조를 더 체계적으로 바꾸는 식으로 리팩터링하는 방법을 설명한다.

## 1장 리팩터링 : 첫번째 예시

**Before**

![](RefactoringImage/2022-03-10-22-43-58.png)
![](RefactoringImage/2022-03-10-22-45-02.png)

아래의 과정을 거쳐서

- statement() 함수 쪼개기
  - 적립 포인트 계산 코드 추출하기
  - format 변수 제거하기
- 계산 단계와 포맷팅 단계 분리하기


**중간점검**

처음보다 코드량이 부쩍 늘었다. 원래 44줄짜리 코드가 지금은 htmlStatement() 를 빼고도 70줄이나 된다. 늘어난 주된 원인은 함수로 추출하면서 함수 본문을 열고 닫는 괄호가 덧붙었기 때문이다. 그 외에 달라진 점이 없다면 안 좋은 징조지만, 다행히 그렇지는 않다. 추가된 코드 덕분에 전체 로직을 구성하는 요소 각각이 더 뚜렷이 부각되고, 계산하는 부분과 출력 형식을 다루는 부분이 분리됐다. 이렇게 무듈화하면 각 부분이 하는 일과 그 부분들이 맞물려 돌아가는 과정을 파악하기 쉬워진다. 모듈화된 덕분에 계산 코드를 중복하지 않고도 HTML 버전을 만들 수 있었다.

![](RefactoringImage/2022-03-10-22-46-05.png)
![](RefactoringImage/2022-03-10-22-46-21.png)
![](RefactoringImage/2022-03-10-22-46-31.png)


다시 아래의 과정을 거쳐서

- 다형성을 활용해 계산 코드 재구성하기
  - 조건부 로직을 다형성으로 바꾸기
  - 공연료 계산기 만들기
  - 함수들을 계산기로 옮기기
  - 공연료 계산기를 다형성 버전으로 만들기

![](RefactoringImage/2022-03-12-14-34-57.png)
![](RefactoringImage/2022-03-12-14-35-30.png)
![](RefactoringImage/2022-03-12-14-36-04.png)

앞에서 함수를 추출했을 때처럼, 이번에도 구조를 보강하면서 코드가 늘어났다. 이번 수정으로 나아진 점은 연극 장르별 계산 코드들을 함께 묶어뒀다는 것이다. 앞으로의 수정 대부분이 이 코드에서 이뤄질 것 같다면 이렇게 명확하게 분리해두면 좋다. 이제 새로운 장르를 추가하려면 해당 장르의 서브클래스를 작성하고 생성 함수인 createPerformanceCalculator()에 추가하기만 하면 된다.

이번 예를 보면 서브클래스를 언제 사용하면 좋은지 감이 잡힐 것이다. 여기서는 두 개의 함수 amountFor()와 volumeCreditsFor()의 조건부 로직을 생성 함수 하나로 옮겼다. 같은 타입의 다형성을 기반으로 실행되는 함수가 많을수록 이렇게 구성하는 쪽이 유리히다.

계산기가 중간 데이터 구조를 채우게 한 지금의 코드와 달리 createStatementData()가 계산기 자체를 변환하게 구현해도 된다. 이때 자바스크립트 클래스 시스템의 멋진 점 하나가 효과를 발휘하는데, 바로 게터getter 메서드를 호출하는 코드와 일반적인 데이터 접근 코드의 모양이 똑같다는 것이다.(앞의 예제에 calculator.amount 코드는 계산기 클래스의 게텅니 amount()를 호출한 것이다). 한편 계산기 인스턴스를 반환하는 방식과 각각의 출력 값으로 직접 계산하는 방식 중 하나를 선택할 때 나는 결과로 나온 데이터 구조를 누가 사용하는가를 기준으로 결정한다. 이번 예에서는 다형성 계산시를 사용한다는 사실을 숨기기보다는 중간 데이터 구조를 이용하는 방법을 보여주는 편이 낫다고 생각해서 이렇게 작성했다.

**1장 끝**

- 이번 장에서는 리팩터링을 크게 세 단계로 진행했다. 먼저 원본 함수를 중첩 함수 여러 개로 나눴다. 다음으로 단계 쪼개기를 적용해서 계산 코드와 출력 코드를 분리했다. 마지막으로 계산로직을 다형성으로 표현했다. 각 단계에서 코드 구조를 보강했고, 그럴 때마다 코드가 수행하는 일이 더욱 분명하게 드러났다.
- 리팩터링을 대부분 코드가 하는 일을 파악하는 데서 시작한다. 그래서 코드를 읽고, 개선점을 찾고, 리팩터링 작업을 통해 개선점을 코드에 반영하는 식으로 진행한다. 그 결과 코드가 명확해지고 이해하기 더 쉬워진다. 그러면 또 다른 개선점이 떠오르며 선순환이 형성된다. 지금까지 수정한 코드에도 개선할 게 몇 가지 더 있지만, 이 정도면 원본 코드를 크게 개선한다는 목표는 충분히 달성했다고 생각한다.
- **좋은 코드를 가늠하는 확실한 방법은 '얼마나 수정하기 쉬운가'다.**