# 배워서 바로 쓰는 14가지 AWS 구축 패턴

## 1부 웹 시스템

### 최소 구성은 단일 서버 실수하기 쉬운 설정 문제 주의

![](Image/2021-06-01-20-30-15.png)

![](Image/2021-06-01-20-31-16.png)

- 서버를 구성하는 가장 기본적인 서비스는 가상 서버인 EC2(Amazon Elastic Compute Cloud) 와 가상 스토리지 볼륨인 EBS(Amazon Elastic Block Store)입니다. 이 둘로 웹 서버를 구축합니다.
- 네트워크에 필요한 기본적인 서비스는 표준 서비스에 포함되어 있습니다. 예를 들어 VPC의 내부에 가상 라우터를 설치할 수 있습니다. 인터넷과 접속하는 데 '인터넷 게이트웨이'도 이용할 수 있습니다. 이번 케이스에는 이벤트 사이트의 호스트명을 정의하는 데 DNS 기능을 제공하는 서비스 아마존 라우트 53(Amazon Route 53)를 사용합니다.

**리전에 따른 응답 속도와 비용 차이**

- 구축 시 가장 먼저 리전을 선택해야 합니다. 응답 속도는 AWS 데이터 센터와 이벤트 사이트에 접속하는 사용자가 지리적으로 가까울수록 빠르며 멀수록 느립니다. 국내에 거주하는 사용자를 대상으로 하는 이벤트 사이트의 응답 속도를 빠르게 하고 싶다면 서울 리전을 선택합니다.
- 리전을 정했으면 VPC(Virtual Private Cloud)와 서브넷으로 구성하는 가상 네트워크를 작성합니다. **VPC는 논리적으로 격리된 사용자 전용 네트워크 구역입니다.**
  - 복수의 가용 영역(Availability Zones)에 걸친 형태로 VPC 하나를 작성할 수 있습니다. 단 복수의 리전에 걸쳐서 작성할 수는 없습니다. 서브넷은 VPC를 논리적으로 분리한 서브네트워크로 AWS 환경 내의 네트워크 최소 단위입니다. 서브넷은 단일 가용 영역 안에 작성합니다. 가상 서버를 비롯한 각종 AWS 서비스는 서브넷에 배치됩니다.

![](Image/2021-06-01-20-40-12.png)

서브넷을 나누는 방법은 온프레미스 환경과 비슷합니다. 논리적인 네트워크를 설계해서 AWS의 서브넷 구성에 대입시킵니다. 예를 들어 인터넷으로 HTTP 수신이 가능한 웹 서버와, 웹 서버로부터 데이터베이스 접속만 허가하는 데이터베이스 서버는 필터링 정책이 다르기 때문에 서브넷을 분리해야 합니다.

**EC2 인스턴스 작성하기**

- VPC와 서브넷을 작성했으니 이벤트 사이트의 웹 서버가 되는 EC2의 인스턴스를 작성합니다. 인스턴스는 AWS상의 가상 서버입니다. 다른 서비스에서도 인스턴스라는 용어를 사용하기 때문에 EC2의 인스턴스를 EC2 인스턴스라고 부릅니다.

![](Image/2021-06-01-20-45-52.png)

- EC2 인스턴스는 웹 설정 화면에서 미리 정의된 옵션을 선택하여 설정할 수 있습니다. 우선 AMI(Amazon Machine Image)를 선택합니다. AMI는 즉시 사용이 가능한 상태의 OS 및 패키지의 조합입니다. 이용 목적에 가까운 AMI를 선택하여 필요에 따라 최적화합니다.
- AMI의 가상화 타입으로 완전가상화인 HVM과 반가상화인 PV가 있습니다. 일반적으로는 HVM을 선택합니다. AWS는 PV의 지원을 축소하면서 HVM으로 전환을 진행하고 있어 HVM 성능이 더 좋습니다.
- 이어서 AMI 인스턴스 유형을 선택합니다. 인스턴스는 서버 규모에 해당하며, CPU, 메모리, 스토리지, 네트워크 성능의 조합을 할 수 있습니다.

**네트워크 및 셧다운 동작 설정 주의 사항**

인스턴스 유형을 정했다면 다음은 EC2 인스턴스를 설정할 차례입니다. 

- 네트워크는 VPC를 선택합니다. 2013년 이전에 계정을 개설한 사용자는 EC2-Classic도 선택할 수 있지만 이것은 VPC가 등장하기 이전의 낡은 네트워크 구성입니다. 앞으로는 VPC 사용이 필수이기 때문에, 특별한 이유가 없으면 VPC를 선택해야 합니다.
- AWS는 수시로 서비스가 업데이트되기 때문에 기존 서비스와 새로운 서비스가 혼재하는 경우가 있습니다. 따라서 서비스 내용을 충분히 파악하고 선택하는 것이 중요합니다.
- 퍼블릭 IP 주소를 자동 할당하는 퍼블릭 IP 자동 할당(Auto-assign Public IP) 기능을 비활성화(Disable) 합니다. 활성화하면 동적 퍼블릭 IP 주소가 부여되어 인터넷에서 접속이 가능해집니다. 단, 이 설정으로 부여된 퍼블릭 IP 주소나 퍼블릭 DNS는 EC2 인스턴스가 다시 시작할 때마다 자동으로 변겨오딥니다. 따라서 재시작할 때마다 IP 주소 또는 DNS를 다시 지정해주어야 합니다. 이번에는 이 설정에서 퍼블릭 IP 주소를 할당하고 나중에 고정 퍼블릭 IP 주소를 할당하는 별도의 서비스를 이용합니다.

**보안 그룹 설정으로 통신 필터링하기**

EC2 인스턴스 서정의 마지막 단계는 보안 그룹 설정입니다. 보안 그룹은 OS 레벨에서 네트워크 통신 필터링 룰을 정하는 것으로 허가할 프로토콜을 설정합니다.

- 보안 그룹 Source의 초기 설정값이 Anywhere로 되어 있는데, 이는 모든 IP 주소로부터의 SSH 접속을 하가한다는 의미입니다. 이대로라면 어떤 IP 든 SSH 접속을 허용하기 때문에 Source 값으로 My IP 를 설정합니다. 그렇게 하면 현재 접속한 기기의 퍼블릭 IP 주소에서의 접속만을 받아들이게 됩니다. 퍼블릭 IP 주소가 여럿인 경우는 'Custom IP'를 선택하고 주소 범위를 CIDR 표기법 (클래스 없는 도메인 간 라우팅 기법)으로 적습니다.

**고정 IP와 호스트명으로 접속하게 하기**

아직 인터넷으로 시작된 EC2 인스턴스에 접속할 수 없습니다. 인터넷으로 접속하려면 고정 퍼블릭 IP 주소와 FQDN(호스트명) 을 부여해야 합니다. 고정 퍼블릭 IP 주소를 AWS에서는 EIP(Elastic IP)라고 부릅니다.

EIP를 포함한 서비스 설정 변경과 추가는 매니지먼트 콘솔(AWS Management Console) 에서 합니다. EIP 설정은 매니지먼트 콘솔을 통해 EC2 서비스로 들어간 후 탐색창의 'Elastic IPs' 페이지에서 'Allocate New Address'를 선택합니다. 이것으로 고정 퍼블릭 IP 주소를 얻었습니다. 다음에는 이 주소를 EC2 인스턴스에 연결시킵니다. 취득한 EIP를 마우스로 오른쪽 클릭하여 콘텍스트 메ㅇ뉴에서 'Associate Address'를 선택합니다. "instance' 항목을 클릭하여 조금 전 작성한 이벤트 사이트의 EC2 인스턴스 이름을 선택합니다.

이상으로 웹 서버에 고정 퍼블릭 IP 주소가 할당되어 인터넷으로부터의 접속이 가능해졌습니다.

**VPC 설정으로 인터넷 접속 설정하기**

인터넷에서 접속하려면 한 가지 설정이 더 필요합니다. AWS 에서는 VPC 이용이 필수입니다. VPC는 AWS 데이터 센터 내부에 마련된 가상의 폐쇄 네트워크이며, 외부와 통신할 수 있도록 설정해야 합니다. 이벤트 사이트는 기본 설정에서 두 군데만 수정하면 됩니다.

첫 번째는 VPC의 DNS 관련 설정입니다. 매니지먼트 콘솔의 VPC 설정 화면에서 'DNS resolution'과 'DNS hostnames'를 확인합니다. 'no'로 되어 있다면 'yes'로 변경합니다. 'DNS resolution'은 VPC 내에서 DNS 확인을 활성화할지 여부를, 'DNS hostname'은 DNS 이름을 부여할지 여부를 관리하는 설정으로 인터넷에서 FQDN에 접속하는 데 필요합니다.

두 번째는 라우팅 설정입니다. 라우팅 테이블에 인터넷 게이트웨이가 설정되어 있지 않으면 인터넷 접속이 불가능합니다. VPC 설정 화면 탐색창의 'Route Tables'에서 라우팅 테이블을 선택하고 하단 창의 'Routes' 탭을 확인합니다.

**OS 환경을 웹 서버로 설정하기**

이어서 EC2 인스턴스의 Os 환경을 설정합니다. 아마존 리눅스의 초기 상태는 최소한의 서비스와 AWS 도구가 설치되어 있을 뿐, LAMP 환경은 설치되어 있지 않습니다. 따라서 LAMP 를 인스톨해야 웹 서버로 사용할 수 있습니다.

**운영 중에 리소스를 유연하게 별경하기**

운영 중인 서버의 CPU, 메모리, 디스크가 부족하게 되는 경우를 생각해봅시다. 온프레미스 환경에서는 미리 넉넉하게 구축하거나 부족할 때마다 증설 작업을 하지만, AWS 에서는 간단한 조작만으로도 자원을 추가할 수 있습니다.

CPU와 메모리는 EC2 인스턴스를 작성할 대 확인한 인스턴스 유형을 다시 고르는 것으로 변경할 수 있습니다. 변경하려면 EC2 인스턴스를 정지(Stop)하고, 설정을 변경합니다.

디스크 추가는 EBS 용량 변경으로 실시합니다. 디스크는 가상 저장소인 EBS로서 EC2 인스턴스와는 독립적으로 만듭니다. EBS 용량은 관리 콘솔에서 1GB 단위로 설정할 수 있습니다. EBS를 EC2에 연결(Attach) 하면, 서버의 디스크 볼륨으로 인식됩니다.

**이벤트 사이트를 종료하면서 할 일**

이벤트가 종료되었다면 이벤트 사이트를 닫습니다. 서비스를 그대로 두면 계속해서 비용이 발생합니다. 그러므로 비용이 발생하는 서비스를 중지합시다.

EC2 인스턴스는 중지해도 유지하는 용량만큼 청구됩니다. 재사용 계획이 없다면 데이터를 백업해놓은 후에 매니지먼트 콘솔의 EC2 인스턴스 설정 화면에서 Terminate를 클릭하여 삭제합니다. Enable termination protection(종료 보호 활성화)를 무효화시킨 후에 삭제합니다. EBS 역시 EC2 인스턴스에서 분리하여 유지하더라도 비용이 청구됩니다. 필요 없으면 삭제해야 합니다.

EIP는 조금 달라서, EC2 인스턴스에 연결되어 있을 때는 과금되지 않지만, 연결되어 있지 않다면 과금됩니다.

라우트 53은 DNS 존 단위로 월정액 과금됩니다. 이벤트 사이트가 속하는 영역을 사용하지 않는다면 삭제해야 하지만 영역을 계속 이용하는 경우는 삭제할 필요가 없습니다.

VPC 는 연결 및 데이터 전송에 비용이 발생하지만, VPC 유지 자체 비용은 청구되지 않습니다. 따라서 제거할 필요는 없습니다.

#### 관리형 서비스

AWS 를 EC2로 대표되는 IaaS(Infrastructure as a Service)를 제공하는 클라우드 사업자로 인식하는 분이 많을 겁니다. 하지만 실제로는 OS와 미들웨어까지 관리하는 PaaS(Platform as a Service)와 소프트웨어까지 관리하는 SaaS(Software as a Service) 도 제공하여 그 숫자가 점점 늘고 있습니다.

이러한 서비스를 관리형 서비스라고 부릅니다. 주요 관리형 서비스로는 스토리지 서비스 아마존 S3, 데이터베이스 서비스 아마존 RDS, DNS 서비스 아마존 라우트 53, 서버리스(Serverless) 코드 실행 서비스 아마존 람다(AWS Lambda) 등이 있습니다.

관리형 서비스에서는 사용자가 OS 에 접속할 수 없습니다. AWS가 인스턴스를 관리하기 대문입니다. 장점은 버전업이나 다중화, 백업 등의 작업을 사용자가 직접 할 피룡가 없다는 점입니다. 단점은 성능 문제가 발생해도 개선 방안이 많지 않다는 것입니다. 사용자가 변경 가능한 범위가 적어지기 대문에 바꿀 수 있는 범위도 적기 때문입니다.

## 2부 스토리지 시스템

## 3부 데이터 분석 시스템

## 4부 애플리케이션 쾌속 개발

## 5부 클라우드 네이티브

## 6부 하이브리드 클라우드